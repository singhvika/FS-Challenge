
<!DOCTYPE html>
<html>
<head>


<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Bootstrap related css and js files. includes jquery  -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>


<!-- Material Design Lite -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

</head>

<body>

<div class="container">
  <div class="row">
          <div class="col-xs-12 col-md-12 col-sm-12 col-lg-12 card">
            <div class="row card-header bg-primary text-white">
              <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                Infinite Image Uploads
              </div>

              <div class="col-xs-4 col-md-4 col-sm-4 col-lg-4 text-right">
                Add Images
                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored mdl-js-ripple-effect" data-toggle="modal" data-target="#addImageModal">
                  <i class="material-icons">add</i>
                </button>
              </div>


            </div>

            <div class="row card-body">
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 mx-auto">
              <input type="text" class="form-control" placeholder="Search by description"/ >
            </div>

            </div>

            <div class="row card-body" id="imgs">

            </div>

            <div class="row card-footer">

            </div>



          </div>



  </div>

</div>

<!-- popup modal window for adding new images -->

<div class="modal" id="addImageModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Enter a valid image url</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <div class="form-group">
          <label for="imgUrl">Enter img url</label>
          <input type="text" class="form-control" id="imgUrl"/>

          <label for="imgDesc">Enter img description</label>
          <input type="text" class="form-control" id="imgDesc"/>
        </div>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="addImageButton">Add Image</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<script>

function refreshImages(){
  $(document).ready(function(){

  var imgContainer = document.getElementById("imgs");
  while(imgContainer.firstChild){
    imgContainer.removeChild(imgContainer.firstChild);

  }
  console.log("removed existing");

  let imgRecords = getImgRecords();
  imgRecords.forEach(function(record){
    let imgFrame = document.createElement('div');
    imgFrame.className='card col-xs-3 col-sm-3 col-md-3 col-lg-3 no-gutters';
    imgFrame.innerHTML= `<img src=\"${record.url}\" class=\"card-img-top\" alt=\"Cinque Terre\">
    <div class=\"card-body\">
      <p class=\"card-text\">${record.desc}</p>
      <a href=\"${record.url}\" class=\"btn btn-primary\">Original Picture</a>
      <button name="imgDeleteButton" class=\"btn btn-danger deleteImg\" data-img-url="${record.url}" onClick="deleteImage('${record.url}')">Delete</button>
    </div>`
    imgContainer.appendChild(imgFrame);
  })



  })
}



function getImgRecords(){
  let imgRecords;
  if ( localStorage.getItem("imgRecords")!==null)
  {
    imgRecords = JSON.parse(localStorage.getItem("imgRecords"));

  }
  else {
    imgRecords = []
  }

  return imgRecords;
}



//function to add new Image

$(document).ready(function(){
  document.getElementById("addImageButton").addEventListener("click", function(){
    console.log(document.getElementById("imgUrl").value);
    let upUrl = document.getElementById("imgUrl").value;
    let description = document.getElementById("imgDesc").value;

    if(upUrl.length!==0 && description.length!==0){

      let imgRecords = getImgRecords();




      let record = {
        url: upUrl,
        desc: description
      }

      let filteredRecords = imgRecords.filter((record) => upUrl === record.url);

      if (filteredRecords.length === 0)
      {
        imgRecords.push(record);
        localStorage.setItem("imgRecords", JSON.stringify(imgRecords));
        refreshImages();
      }
      else {
        alert("duplicate image");
      }



      }else {
        alert("Please enter Image URL and Description");
      }
  })
})






// delete image function

$(document).ready(function(){
  refreshImages();
})




function deleteImage(imgUrl) {
console.log(imgUrl);
var imgRecords = getImgRecords();
var filteredRecords = imgRecords.filter((record) => record.url !==imgUrl);
localStorage.setItem('imgRecords',JSON.stringify(filteredRecords));
refreshImages();

}

</script>


</body>
</html>
